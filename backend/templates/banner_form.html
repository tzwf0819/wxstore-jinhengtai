{% extends "base.html" %}

{% block title %}{% if is_edit %}编辑轮播图{% else %}添加新轮播图{% endif %}{% endblock %}

{% block content %}
<div class="container mt-4">
    <h2>{% if is_edit %}编辑轮播图 #{{ banner.id }}{% else %}添加新轮播图{% endif %}</h2>

    <form action="{% if is_edit %}{{ url_for('update_banner_web', banner_id=banner.id) }}{% else %}{{ url_for('create_banner_web') }}{% endif %}" method="post" enctype="multipart/form-data">
        
        <div class="mb-3">
            <label for="image" class="form-label">轮播图图片</label>
            <div>
                <img id="image-preview" 
                     src="{% if banner and banner.image_url %}{{ url_for('static', path=banner.image_url) }}{% else %}#{% endif %}" 
                     alt="Image Preview" 
                     class="img-thumbnail mb-2" 
                     style="max-width: 300px; max-height: 150px; display: {% if banner and banner.image_url %}block{% else %}none{% endif %}; object-fit: cover;">
            </div>
            <input type="file" class="form-control" id="image" name="image" accept="image/*" {% if not is_edit %}required{% endif %}>
        </div>

        <div class="mb-3">
            <label for="sort_order" class="form-label">排序</label>
            <input type="number" class="form-control" id="sort_order" name="sort_order" value="{{ banner.sort_order if banner else 1 }}" required>
        </div>
        
        <div class="form-check mb-3">
            <input type="checkbox" class="form-check-input" id="is_active" name="is_active" value="true" {% if banner and banner.is_active %}checked{% endif %}>
            <label class="form-check-label" for="is_active">激活</label>
        </div>

        <button type="submit" class="btn btn-primary">{% if is_edit %}更新轮播图{% else %}创建轮播图{% endif %}</button>
        <a href="{{ url_for('list_banners_web') }}" class="btn btn-secondary">取消</a>
    </form>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const imageInput = document.getElementById('image');
    const imagePreview = document.getElementById('image-preview');

    imageInput.addEventListener('change', function(event) {
        const file = event.target.files[0];
        if (file) {
            const reader = new FileReader();
            
            reader.onload = function(e) {
                imagePreview.src = e.target.result;
                imagePreview.style.display = 'block';
            };
            
            reader.readAsDataURL(file);
        }
    });
});
</script>
{% endblock %}
