{% extends "base.html" %}

{% block title %}{% if is_edit %}编辑商品{% else %}添加新商品{% endif %}{% endblock %}

{% block sidebar %}
    <a href="/admin/products" class="secondary outline">← 返回商品列表</a>
{% endblock %}

{% block content %}
<div class="form-container">
    <form action="{% if is_edit %}/admin/products/edit/{{ product.id }}{% else %}/admin/products/new{% endif %}" method="post" enctype="multipart/form-data" class="card">
        <label for="name">商品名称</label>
        <input type="text" id="name" name="name" value="{{ product.name if product else '' }}" required>

        <label for="description">描述</label>
        <textarea id="description" name="description">{{ product.description if product else '' }}</textarea>

        <label for="price">价格</label>
        <input type="number" id="price" name="price" step="0.01" value="{{ product.price if product else '' }}" required>
        
        <label for="category">分类</label>
        <input type="text" id="category" name="category" value="{{ product.category if product else '' }}">

        <label for="image">商品图片 (可选)</label>
        
        <!-- Unified Image Preview Box -->
        <img id="image-preview" 
             src="{% if product and product.image_url %}{{ request.scope.get('root_path', '') }}{{ product.image_url }}{% endif %}" 
             alt="Image Preview" 
             style="max-width: 150px; max-height: 150px; display: {% if product and product.image_url %}block{% else %}none{% endif %}; margin-bottom: 1rem; border-radius: var(--border-radius);">
        
        <input type="file" id="image" name="image" accept="image/*">

        <button type="submit" style="margin-top: 1rem;">{% if is_edit %}更新商品{% else %}创建商品{% endif %}</button>
    </form>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const imageInput = document.getElementById('image');
    const imagePreview = document.getElementById('image-preview');

    imageInput.addEventListener('change', function(event) {
        const file = event.target.files[0];
        if (file) {
            const reader = new FileReader();
            
            reader.onload = function(e) {
                imagePreview.src = e.target.result;
                imagePreview.style.display = 'block'; // Make it visible if it was hidden
            };
            
            reader.readAsDataURL(file);
        }
    });
});
</script>
{% endblock %}
